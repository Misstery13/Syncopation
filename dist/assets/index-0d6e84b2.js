(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function B(n){return{...n,isGameStoped:!0}}function O(n){return{...n,isRunning:!0,isPaused:!1}}function P(n){return{...n,level:n.level+1}}function x(n){return N(n,1)}function N(n,e){const t=Number.isFinite(n.score)?n.score:0,s=Number.isFinite(e)?e:0,i=Math.max(0,t+s);return{...n,score:i}}class U{constructor(){this.isRunning=!1,this.canvas=document.getElementById("gameCanvas"),this.ctx=this.canvas.getContext("2d"),this.isRunning=!1,this.config={width:window.innerWidth,height:window.innerHeight,backgroundColor:"#000000",physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}}},this.gameState={isRunning:!1,isPaused:!1,currentTimeMs:0,currentScene:"menu",score:0,level:1,precision:0,isGameStoped:!1,song:{idSong:"",difficulty:"normal",tempos:[]}},this.resizeCanvas(),window.addEventListener("resize",()=>{this.config.width=window.innerWidth,this.config.height=window.innerHeight,this.resizeCanvas()})}start(){this.isRunning||(this.isRunning=!0,console.log("üéÆ Juego iniciado"),this.gameState=O(this.gameState),this.gameLoop())}resizeCanvas(){this.canvas.width=this.config.width,this.canvas.height=this.config.height}gameLoop(){this.isRunning&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),requestAnimationFrame(()=>this.gameLoop()))}stop(){this.gameState=B(this.gameState),this.isRunning=!1,console.log("‚è∏ Juego detenido")}getState(){return{...this.gameState}}updateScore(){this.gameState=x(this.gameState),console.log(`El jugador ha obtenido un punto. Total: ${this.gameState.score}`),this.gameState=x(this.gameState),console.log(`Nivel avanzado a: ${this.gameState.level}`)}nextLevel(){this.gameState=P(this.gameState),console.log(`Nivel avanzado a: ${this.gameState.level}`)}}class T{constructor(){this.currentUser=null,this.storageKey="syncopation_users",this.tempSaveKey="temp_game_progress"}init(){localStorage.getItem(this.storageKey)||localStorage.setItem(this.storageKey,JSON.stringify([]))}getUsers(){const e=localStorage.getItem(this.storageKey);return e?JSON.parse(e):[]}saveUsers(e){localStorage.setItem(this.storageKey,JSON.stringify(e))}register(e,t){const s=this.getUsers();if(s.find(o=>o.username===e))return{success:!1,message:"El usuario ya existe"};const i={username:e,password:this.hashPassword(t),progress:{level:1,score:0,lastSaved:new Date().toISOString()},createdAt:new Date().toISOString()};return s.push(i),this.saveUsers(s),{success:!0,message:"Cuenta creada exitosamente"}}login(e,t){const i=this.getUsers().find(o=>o.username===e);return i?i.password!==this.hashPassword(t)?{success:!1,message:"Contrase√±a incorrecta"}:(this.currentUser=i,sessionStorage.setItem("currentUser",e),{success:!0,message:"Sesi√≥n iniciada",user:i}):{success:!1,message:"Usuario no encontrado"}}loginAsGuest(){return this.currentUser={username:"guest",isGuest:!0},sessionStorage.setItem("currentUser","guest"),{success:!0,message:"Jugando como invitado",user:this.currentUser}}saveProgress(e){if(this.currentUser&&!this.currentUser.isGuest){const t=this.getUsers(),s=t.findIndex(i=>i.username===this.currentUser.username);if(s!==-1)return t[s].progress={...e,lastSaved:new Date().toISOString()},this.saveUsers(t),{success:!0,type:"permanent",message:"Progreso guardado permanentemente"}}else return localStorage.setItem(this.tempSaveKey,JSON.stringify(e)),{success:!0,type:"temporary",message:"Progreso guardado temporalmente"};return{success:!1,message:"Error al guardar progreso"}}loadProgress(){if(this.currentUser&&!this.currentUser.isGuest){const t=this.getUsers().find(s=>s.username===this.currentUser.username);if(t&&t.progress)return{success:!0,data:t.progress,type:"permanent"}}else{const e=localStorage.getItem(this.tempSaveKey);if(e)return{success:!0,data:JSON.parse(e),type:"temporary"}}return{success:!1,message:"No hay progreso guardado"}}logout(){this.currentUser=null,sessionStorage.removeItem("currentUser")}isAuthenticated(){const e=sessionStorage.getItem("currentUser");return e?e==="guest"?!0:this.getUsers().find(i=>i.username===e)!==void 0:!1}getCurrentUser(){const e=sessionStorage.getItem("currentUser");return e?e==="guest"?{username:"guest",isGuest:!0}:this.getUsers().find(s=>s.username===e)||null:null}hashPassword(e){let t=0;for(let s=0;s<e.length;s++){const i=e.charCodeAt(s);t=(t<<5)-t+i,t=t&t}return t.toString()}}class D{constructor(e){this.selectedIndex=0,this.currentFormInputs=[],this.inputIndex=0,this.currentScreen="menu",this.authService=new T,this.callbacks=e??{},this.initElements(),this.initEventListeners(),this.menuOptions.length>0&&this.menuOptions[this.selectedIndex].classList.add("selected")}initElements(){this.menuScreen=document.getElementById("menuScreen"),this.loginScreen=document.getElementById("loginScreen"),this.registerScreen=document.getElementById("registerScreen"),this.gameCanvas=document.getElementById("gameCanvas"),this.mainMenuScreen=document.getElementById("mainMenuScreen")??void 0,this.loginForm=document.getElementById("loginForm"),this.registerForm=document.getElementById("registerForm"),this.loginMessage=document.getElementById("loginMessage"),this.registerMessage=document.getElementById("registerMessage");const e=document.getElementById("backToMenuBtn")??document.getElementById("backtoMenuBtn"),t=document.getElementById("backToMenuBtn2")??document.getElementById("backToLoginBtn");if(!e||!t)throw new Error("[LoginManager] Botones de regreso no encontrados");this.backToMenuBtn=e,this.backToMenuBtn2=t,this.menuOptions=this.menuScreen.querySelectorAll(".menu-option")}initEventListeners(){document.addEventListener("keydown",e=>this.handleKeyPress(e)),this.menuOptions.forEach((e,t)=>{e.addEventListener("click",()=>this.selectMenuOption(t))}),this.loginForm.addEventListener("submit",e=>{e.preventDefault(),this.handleLogin()}),this.registerForm.addEventListener("submit",e=>{e.preventDefault(),this.handleRegister()}),this.backToMenuBtn.addEventListener("click",()=>this.showMenu()),this.backToMenuBtn2.addEventListener("click",()=>this.showMenu())}handleKeyPress(e){this.currentScreen==="menu"?this.handleMenuNavigation(e):(this.currentScreen==="login"||this.currentScreen==="register")&&this.handleFormNavigation(e)}handleMenuNavigation(e){["ArrowUp","ArrowDown","Enter"].includes(e.key)&&e.preventDefault(),e.key==="ArrowUp"?this.changeSelection(-1):e.key==="ArrowDown"?this.changeSelection(1):e.key==="Enter"&&this.activateSelectedOption()}changeSelection(e){this.menuOptions[this.selectedIndex].classList.remove("selected"),this.selectedIndex=(this.selectedIndex+e+this.menuOptions.length)%this.menuOptions.length,this.menuOptions[this.selectedIndex].classList.add("selected")}selectMenuOption(e){this.selectedIndex=e,this.menuOptions.forEach(t=>t.classList.remove("selected")),this.menuOptions[e].classList.add("selected"),this.activateSelectedOption()}activateSelectedOption(){const e=this.menuOptions[this.selectedIndex],t=e.dataset.action;this.menuOptions.forEach(s=>{s!==e&&s.classList.add("fade-out")}),setTimeout(()=>{t==="login"?this.showLogin():t==="register"?this.showRegister():t==="guest"&&this.handleGuestLogin()},400)}handleFormNavigation(e){if(e.key==="Escape"){e.preventDefault(),this.showMenu();return}const t=this.currentFormInputs;t.length&&(e.key==="ArrowUp"?(e.preventDefault(),this.inputIndex=(this.inputIndex-1+t.length)%t.length,t[this.inputIndex].focus()):e.key==="ArrowDown"||e.key==="Tab"?(e.preventDefault(),this.inputIndex=(this.inputIndex+1)%t.length,t[this.inputIndex].focus()):e.key==="Enter"&&(e.preventDefault(),this.currentScreen==="login"&&this.loginForm.requestSubmit(),this.currentScreen==="register"&&this.registerForm.requestSubmit()))}handleLogin(){const e=document.getElementById("username").value,t=document.getElementById("password").value;if(!e||!t){this.showMessage(this.loginMessage,"Completa todos los campos",!1);return}const s=this.authService.login(e,t);this.showMessage(this.loginMessage,s.message,s.success),s.success&&setTimeout(()=>{this.notifyAuthSuccess("login",s.user??null)},1e3)}handleRegister(){const e=document.getElementById("regUsername").value,t=document.getElementById("regPassword").value,s=document.getElementById("regConfirmPassword").value;if(!e||!t||!s){this.showMessage(this.registerMessage,"Completa todos los campos",!1);return}if(t!==s){this.showMessage(this.registerMessage,"Las contrase√±as no coinciden",!1);return}const i=this.authService.register(e,t);this.showMessage(this.registerMessage,i.message,i.success),i.success&&setTimeout(()=>{const o=this.authService.login(e,t),c=o.success?o.user??null:null;this.showMessage(this.registerMessage,o.message,o.success),o.success?this.notifyAuthSuccess("register",c):(this.showLogin(),document.getElementById("username").value=e)},1200)}handleGuestLogin(){const e=this.authService.loginAsGuest();e.success&&this.notifyAuthSuccess("guest",e.user??null)}showMenu(){var e;this.hideAll(),this.selectedIndex=0,this.menuScreen.style.display="flex",this.menuOptions.forEach(t=>t.classList.remove("fade-out")),this.currentScreen="menu",this.menuOptions.forEach(t=>t.classList.remove("selected")),(e=this.menuOptions[this.selectedIndex])==null||e.classList.add("selected")}showLogin(){var e;this.hideAll(),this.loginScreen.style.display="flex",this.currentScreen="login",this.currentFormInputs=Array.from(this.loginForm.querySelectorAll("input")),this.inputIndex=0,(e=this.currentFormInputs[0])==null||e.focus()}showRegister(){var e;this.hideAll(),this.registerScreen.style.display="flex",this.currentScreen="register",this.currentFormInputs=Array.from(this.registerForm.querySelectorAll("input")),this.inputIndex=0,(e=this.currentFormInputs[0])==null||e.focus()}resetToLogin(){var e;this.hideAll(),this.selectedIndex=0,this.menuOptions.forEach(t=>t.classList.remove("fade-out","selected")),(e=this.menuOptions[this.selectedIndex])==null||e.classList.add("selected"),this.currentScreen="menu",this.menuScreen.style.display="flex",this.gameCanvas.style.display="none"}hideAll(){[this.menuScreen,this.loginScreen,this.registerScreen,this.gameCanvas,this.mainMenuScreen].filter(t=>!!t).forEach(t=>t.style.display="none")}showMessage(e,t,s){e.textContent=t,e.className="message",e.classList.add(s?"success":"error")}init(){this.authService.init(),this.showMenu()}notifyAuthSuccess(e,t){var s,i;this.hideAll(),this.currentScreen="mainMenu",(i=(s=this.callbacks).onAuthSuccess)==null||i.call(s,{mode:e,user:t})}}const F=[{id:"level_1",title:"Amanecer R√≠tmico",description:"Una introducci√≥n suave a las s√≠ncopas. Perfecta para calentar.",difficulty:"F√°cil",songFile:"songs/amanecer.mp3",requiresLevel:0},{id:"level_2",title:"Contratiempo",description:"Prep√°rate para notas inesperadas fuera de tiempo.",difficulty:"Normal",songFile:"songs/contratiempo.mp3",requiresLevel:2},{id:"level_3",title:"Frenes√≠ de S√≠ncopa",description:"Un reto de velocidad y precisi√≥n. ¬øPodr√°s mantener el ritmo?",difficulty:"Dif√≠cil",songFile:"songs/frenesi.mp3",requiresLevel:5},{id:"level_4_expert",title:"Pesadilla Polirr√≠tmica",description:"Solo para maestros del ritmo. Requiere total independencia.",difficulty:"Experto",songFile:"songs/pesadilla.mp3",requiresLevel:10}];function p(n,e){const t=n.querySelector(e);if(!t)throw new Error(`[LevelSelectionView] Selector cr√≠tico no encontrado: ${e}`);return t}function q(n,e){const t=document.createElement("div");t.className="level-selection-overlay",t.tabIndex=-1,t.innerHTML=`
    <div class="level-selection-content">
      <div class="level-list-container">
        <h2>Seleccionar Nivel</h2>
        <ul class="level-list">
          </ul>
        <button class="level-back-button" data-action="navigate-back">Volver al Men√∫</button>
      </div>
      
      <div class="level-details-container">
        <h3 id="level-title"></h3>
        <p id="level-description"></p>
        <div class="difficulty" id="level-difficulty"></div>
        <div id="level-requirement"></div>
        <button class="level-play-button" data-action="play-level">¬°Jugar!</button>
      </div>
    </div>
  `;const s=p(t,".level-list"),i=p(t,".level-back-button"),o=p(t,".level-play-button"),c=p(t,"#level-title"),h=p(t,"#level-description"),m=p(t,"#level-difficulty"),a=p(t,"#level-requirement");let l=0;const d=F;function y(r,u){c.textContent=r.title,h.textContent=r.description,m.textContent=`Dificultad: ${r.difficulty}`,m.className="difficulty",m.classList.add(`difficulty-${r.difficulty.toLowerCase()}`),u?(a.textContent=`Requiere Nivel: ${r.requiresLevel}`,a.className="locked",o.disabled=!0,o.textContent="Bloqueado"):(a.textContent="¬°Desbloqueado!",a.className="unlocked",o.disabled=!1,o.textContent="¬°Jugar!")}function k(){s.innerHTML="",d.forEach((u,g)=>{const f=u.requiresLevel>n,v=document.createElement("li");v.className="level-item",v.dataset.index=g.toString(),v.textContent=u.title,f&&v.classList.add("locked"),g===l&&v.classList.add("selected"),s.appendChild(v)});const r=d[l];if(r){const u=r.requiresLevel>n;y(r,u)}}function S(r){if(r===l)return;p(t,`.level-item[data-index="${l}"]`).classList.remove("selected"),l=r,p(t,`.level-item[data-index="${l}"]`).classList.add("selected");const f=d[l],v=f.requiresLevel>n;y(f,v)}function w(){const r=d[l],u=r.requiresLevel>n;r&&!u&&e.onPlay({levelId:r.id,songFile:r.songFile})}function b(){e.onBack()}i.addEventListener("click",b),o.addEventListener("click",w),s.addEventListener("click",r=>{const g=r.target.closest(".level-item");if(g&&g.dataset.index){const f=parseInt(g.dataset.index,10);S(f)}});const I=r=>{switch(["ArrowUp","ArrowDown","Enter","Escape"].includes(r.key)&&r.preventDefault(),r.key){case"ArrowUp":const u=(l-1+d.length)%d.length;S(u);break;case"ArrowDown":const g=(l+1)%d.length;S(g);break;case"Enter":w();break;case"Escape":b();break}};function M(){k(),document.body.appendChild(t),window.addEventListener("keydown",I),t.focus()}function C(){window.removeEventListener("keydown",I),document.body.contains(t)&&document.body.removeChild(t)}function A(){C()}return{show:M,hide:C,destroy:A}}class R{constructor(e){this.view=q(e,{onPlay:t=>this.onPlay(t),onBack:()=>this.onBack()})}show(){return new Promise((e,t)=>{this.resolvePromise=e,this.rejectPromise=t,this.view.show()})}onPlay(e){this.view.hide(),this.resolvePromise(e)}onBack(){this.view.hide(),this.rejectPromise("User navigated back")}}function K(){return{totalScore:0,totalHits:0,totalMisses:0,perfectLevels:0,totalPlayTimeMs:0,gamesPlayed:0}}const $="playerStats";function G(){const n=localStorage.getItem($);return n?JSON.parse(n):K()}function J(n){var t;const e=document.createElement("div");return e.classList.add("stats-container"),e.innerHTML=`
    <div class="header">
      <h2>Estad√≠sticas del Jugador</h2>
      <button id="btnBack" class="back-btn">Volver</button>
    </div>

    <div class="stats-grid">
      <div class="stat-item">
        <span>Total Score</span>
        <strong>${n.totalScore}</strong>
      </div>
      <div class="stat-item">
        <span>Total Hits</span>
        <strong>${n.totalHits}</strong>
      </div>
      <div class="stat-item">
        <span>Total Misses</span>
        <strong>${n.totalMisses}</strong>
      </div>
      <div class="stat-item">
        <span>Perfect Levels</span>
        <strong>${n.perfectLevels}</strong>
      </div>
      <div class="stat-item">
        <span>Total Play Time</span>
        <strong>${(n.totalPlayTimeMs/1e3).toFixed(1)}s</strong>
      </div>
      <div class="stat-item">
        <span>Games Played</span>
        <strong>${n.gamesPlayed}</strong>
      </div>
    </div>
  `,(t=e.querySelector("#btnBack"))==null||t.addEventListener("click",()=>{document.dispatchEvent(new CustomEvent("navigateToMenu"))}),e}function H(){const n=document.getElementById("app-root");if(!n)return;const e=G();n.innerHTML="",n.appendChild(J(e))}function V(){return[{role:"Direcci√≥n",names:["UNIVERSIDAD ESTATAL PENINSULA DE SANTA ELENA"]},{role:"Producci√≥n",names:["PROGRAMACION FUNCIONAL"]},{role:"Programaci√≥n",names:["SAID PINTO","DIANA MELENA","CARLOS PATI√ëO","ANGEL VILLON","PAULO ORRALA"]},{role:"Arte",names:["PAULO ORRALA"]},{role:"M√∫sica",names:["ANGEL VILLON"]},{role:"QA / Testing",names:["Pepe"]},{role:"Agradecimientos",names:["Docente","Colaboradores","Comunidad"]}]}function _(n,e){const t=e.trim().toLowerCase();return t?n.map(s=>({...s,names:s.names.filter(i=>i.toLowerCase().includes(t))})).filter(s=>s.role.toLowerCase().includes(t)||s.names.length>0):n}function j(){const n=document.createElement("div");n.id="credits-overlay",n.innerHTML=`
    <div class="credits-wrap" role="dialog" aria-modal="true" aria-labelledby="credits-title">
      <div class="credits-header">
        <h2 id="credits-title" class="credits-title">Cr√©ditos</h2>
        <div class="credits-actions">
          <button class="credits-btn" data-action="back">Volver</button>
        </div>
      </div>

      <input class="credits-search" type="search" placeholder="Buscar por rol o nombre..." aria-label="Buscar en cr√©ditos" />

      <div class="credits-body" id="credits-body"></div>
    </div>
  `;let e=V();const t=n.querySelector("#credits-body"),s=n.querySelector(".credits-search"),i=n.querySelector('[data-action="back"]');function o(d){t.innerHTML=d.map(y=>`
      <section class="credits-section">
        <div class="credits-role">${y.role}</div>
        <p class="credits-names">${y.names.join(", ")}</p>
      </section>
    `).join("")}function c(){const d=_(e,s.value);o(d)}function h(d){d.key==="Escape"&&a()}function m(){document.body.contains(n)||document.body.appendChild(n),n.classList.add("is-open"),o(e),document.addEventListener("keydown",h),setTimeout(()=>s.focus(),0)}function a(){n.classList.remove("is-open"),document.removeEventListener("keydown",h),window.dispatchEvent(new CustomEvent("ui:navigate",{detail:{to:"main-menu"}}))}function l(){document.removeEventListener("keydown",h),n.remove()}return i.addEventListener("click",a),s.addEventListener("input",c),{open:m,close:a,destroy:l}}let L=j();function z(){window.addEventListener("ui:open-credits",()=>{L.open()}),window.addEventListener("ui:close-credits",()=>{L.close()})}function W(){L.open()}function Q(){return[{id:"angel-levels",label:"Selecci√≥n de Niveles (√Ångel)",description:"Explora los niveles creados por √Ångel y elige una canci√≥n para jugar."},{id:"carlos-stats",label:"Estad√≠sticas del Jugador (Carlos)",description:"Consulta tu progreso, puntajes y logros recopilados por Carlos."},{id:"said-credits",label:"Cr√©ditos Interactivos (Said)",description:"Agradece a todo el equipo con la experiencia de cr√©ditos de Said."}]}class Y{constructor(e){this.items=Q(),this.optionElements=[],this.currentIndex=0,this.isActive=!1,this.authContext=null,this.handleKeyDownBound=a=>this.handleKeyDown(a),this.handleNavigateToMenuBound=()=>this.resumeFromExternalNavigation(),this.handleUiNavigateBound=a=>this.handleUiNavigate(a);const t=document.getElementById("mainMenuScreen"),s=document.getElementById("mainMenuOptions"),i=document.getElementById("mainMenuDescription"),o=document.getElementById("mainMenuSubtitle"),c=document.getElementById("app-root"),h=document.getElementById("logoutBtn"),m=document.getElementById("gameCanvas");if(!t||!s||!i||!o||!c||!h||!m)throw new Error("[MainMenuManager] Elementos cr√≠ticos del DOM no encontrados");this.screen=t,this.optionsList=s,this.description=i,this.subtitle=o,this.appRoot=c,this.logoutBtn=h,this.gameCanvas=m,this.callbacks=e??{},z(),this.renderMenu(),this.logoutBtn.addEventListener("click",()=>this.handleLogout()),document.addEventListener("navigateToMenu",this.handleNavigateToMenuBound),window.addEventListener("ui:navigate",this.handleUiNavigateBound)}show(e){this.authContext=e,this.isActive=!0,this.screen.style.display="flex",this.screen.classList.remove("hidden"),this.gameCanvas.style.display="none",this.renderSubtitle(),this.highlightOption(0),this.clearContent(),this.renderPlaceholder("Selecciona una experiencia para comenzar."),this.attachKeyboard()}hide(){this.isActive=!1,this.screen.style.display="none",this.screen.classList.add("hidden"),this.detachKeyboard()}renderMenu(){this.optionsList.innerHTML="",this.optionElements.length=0,this.items.forEach((e,t)=>{const s=document.createElement("li");s.className="menu-option",s.dataset.sceneId=e.id,s.textContent=e.label,s.tabIndex=0,s.addEventListener("click",()=>{this.highlightOption(t),this.activateSelection()}),s.addEventListener("mouseenter",()=>this.highlightOption(t)),s.addEventListener("focus",()=>this.highlightOption(t)),this.optionsList.appendChild(s),this.optionElements.push(s)})}renderSubtitle(){var s;if(!this.authContext){this.subtitle.textContent="";return}const e=((s=this.authContext.user)==null?void 0:s.username)??"Invitado",t=this.authContext.mode==="guest"?"Sesi√≥n como invitado":this.authContext.mode==="register"?"Cuenta reci√©n creada":"Sesi√≥n iniciada";this.subtitle.textContent=`${t}: ${e}`}highlightOption(e){var t,s;e<0||e>=this.optionElements.length||((t=this.optionElements[this.currentIndex])==null||t.classList.remove("selected"),this.currentIndex=e,(s=this.optionElements[this.currentIndex])==null||s.classList.add("selected"),this.updateDescription())}updateDescription(){const e=this.items[this.currentIndex];this.description.textContent=(e==null?void 0:e.description)??""}attachKeyboard(){document.addEventListener("keydown",this.handleKeyDownBound)}detachKeyboard(){document.removeEventListener("keydown",this.handleKeyDownBound)}handleKeyDown(e){if(this.isActive)switch(["ArrowUp","ArrowDown","Enter","Escape"].includes(e.key)&&e.preventDefault(),e.key){case"ArrowUp":this.moveSelection(-1);break;case"ArrowDown":this.moveSelection(1);break;case"Enter":this.activateSelection();break;case"Escape":this.handleLogout();break}}moveSelection(e){const t=this.optionElements.length;if(t===0)return;const s=(this.currentIndex+e+t)%t;this.highlightOption(s)}activateSelection(){const e=this.items[this.currentIndex];if(e)switch(e.id){case"start-game":this.launchBaseGame();break;case"angel-levels":this.openAngelLevels();break;case"carlos-stats":this.openCarlosStats();break;case"diana-screen":this.showPlaceholder("La experiencia de Diana est√° en preparaci√≥n. ¬°Pronto descubrir√°s su mundo!");break;case"paulo-screen":this.showPlaceholder("Paulo est√° ajustando los √∫ltimos detalles sonoros. ¬°Mantente atento!");break;case"said-credits":this.openSaidCredits();break}}launchBaseGame(){this.hide(),this.detachKeyboard(),this.gameCanvas.style.display="block",window.dispatchEvent(new CustomEvent("startGame"))}openAngelLevels(){var s,i,o;this.detachKeyboard();const e=((o=(i=(s=this.authContext)==null?void 0:s.user)==null?void 0:i.progress)==null?void 0:o.level)??1;new R(e).show().then(c=>{this.renderPlaceholder(`Nivel seleccionado: ${c.levelId}. Canci√≥n: ${c.songFile}.`)}).catch(()=>{this.renderPlaceholder("Selecci√≥n cancelada. Puedes explorar otra opci√≥n.")}).finally(()=>{this.isActive&&this.attachKeyboard()})}openCarlosStats(){this.detachKeyboard(),this.clearContent(),H()}openSaidCredits(){this.detachKeyboard(),W()}clearContent(){this.appRoot.innerHTML=""}showPlaceholder(e){this.clearContent();const t=document.createElement("div");t.className="main-menu-placeholder",t.innerHTML=`
      <p>${e}</p>
      <button class="btn-secondary" type="button">Volver al men√∫</button>
    `,t.querySelector("button").addEventListener("click",()=>this.resumeFromExternalNavigation()),this.appRoot.appendChild(t)}renderPlaceholder(e){this.clearContent();const t=document.createElement("p");t.className="main-menu-helper",t.textContent=e,this.appRoot.appendChild(t)}handleLogout(){var e,t;this.hide(),this.clearContent(),(t=(e=this.callbacks).onLogout)==null||t.call(e)}resumeFromExternalNavigation(){this.authContext&&this.show(this.authContext)}handleUiNavigate(e){var i;((i=e.detail)==null?void 0:i.to)==="main-menu"&&this.resumeFromExternalNavigation()}}let E;const X=new Y({onLogout:()=>{E.resetToLogin()}});E=new D({onAuthSuccess:n=>{X.show(n)}});E.init();window.addEventListener("startGame",()=>{new U().start()});document.addEventListener("DOMContentLoaded",()=>{var m;const n=document.getElementById("configModal"),e=document.getElementById("saveConfigBtn"),t=document.getElementById("volumeRange"),s=document.getElementById("difficultySelect"),i=document.getElementById("fullscreenToggle");if(!n||!e||!t||!s||!i)return;const o=window.bootstrap,c=(m=o==null?void 0:o.Modal)==null?void 0:m.getOrCreateInstance(n);if(!c)return;const h=localStorage.getItem("gameSettings");if(h){const a=JSON.parse(h);typeof a.volume=="number"&&(t.value=String(a.volume)),typeof a.difficulty=="string"&&(s.value=a.difficulty),typeof a.fullscreen=="boolean"&&(i.checked=a.fullscreen)}e.addEventListener("click",()=>{var l;const a={volume:Number.parseInt(t.value,10),difficulty:s.value,fullscreen:i.checked};localStorage.setItem("gameSettings",JSON.stringify(a)),(l=window.game)!=null&&l.sound&&(window.game.sound.volume=a.volume/100),c.hide()})});
